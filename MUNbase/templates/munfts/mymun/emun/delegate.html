<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>{{commname}}: Delegate</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-wEmeIV1mKuiNpC+IOBjI7aAzPcEZeedi5yW5f2yOq55WWLwNGmvvx4Um1vskeMj0" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-p34f1UUtsS3wqzfto5wAAmdvj+osOnFyQFpp4Ua3gs/ZVWx6oOypYoCJhGGScy+8" crossorigin="anonymous"></script>
    <link rel="preconnect" href="https://fonts.gstatic.com">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/multiple-select@1.5.2/dist/multiple-select.min.css">
    <script src="https://unpkg.com/multiple-select@1.5.2/dist/multiple-select.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="//cdn.tinymce.com/4/tinymce.min.js"></script>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/smoothness/jquery-ui.css">
    <script src="//code.jquery.com/jquery-1.12.4.js"></script>
    <script src="//code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="https://cdn.tiny.cloud/1/123046wnx9rmn1uyq9ljnjy75xb7qq2nay9c8xc9lisaoxrq/tinymce/5/tinymce.min.js" referrerpolicy="origin"></script>
    <script>tinymce.init({selector: "textarea",menubar: false,plugins: "link image code lists",content_style:
    "body { font-size: 14pt; font-family: serif; }",toolbar: 'undo redo | styleselect | forecolor | bold italic | alignleft aligncenter alignright alignjustify | outdent indent | link image | numlist | bullist '});    </script>
</head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-light bg-primary" style="padding: 20px; color: white;">
        <a class="navbar-brand" href="#">EMUN: {{country}}</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav mr-auto">
            <li class="nav-item active">
              <a class="nav-link" onclick="voting();">Voting</a>
            </li>
            <li class="nav-item active">
              <a class="nav-link" onclick="paperwork();">Resolutions/Clauses</a>
            </li>
            <li class="nav-item active">
              <a class="nav-link" onclick="ammendments();">Ammendments</a>
            </li>

            <li class="nav-item active">
              <a class="nav-link" href="{% url 'commlogout'%}">Logout</a>
            </li>
          </ul>

        </div>
    </nav>

      <div class="container">
        <br><br>
        <div class="row justify-content-center" ><!--voting-->
          <div class="col-md" id ='voting'>
            <table>
              <h2>Vote for Motions</h2>
              <table class="table table-responsive table-striped">
              <thead>
                <tr>
                  <th scope="col"  style="width: 200px;">Name</th>
                  <th scope="col"  style="width: 100px;">Proposer</th>
                </tr>
                <tbody id ='motiondata'>

                </tbody>
              </thead>
              </table>
            </table>
          </div>
        </div>
        <div class="row justify-content-center" ><!--paperwork-->
          <div class="col-md" id ='paperwork'>
            <h2>Paperwork</h2>
            <br>
            <label for="resoname">Name of the Paperwork  </label><input onchange='updateinfo()'id ='resoname' type ='text'></input> <br> <br>
            <label for="resoname">Number of Aditional Submitters  </label><input id ='resoname' onchange='updateinfo()' type='number' value='0' ></input> <br> <br> <br>

            <div id='adsub'>

            </div>
            <textarea id="cookiedpaperwork" onchange ='updateinfo()'rows="8" cols="80"></textarea>
          </div>
        </div>
        <div class="row justify-content-center" ><!--ammendments-->
          <div class="col-md" id ='ammendment'>
            <h2>Ammendments</h2>
          </div>
        </div>
      </div>
    <div class="modal" tabindex="-1" id='sendvotemodal'role="dialog">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Motion Vote</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <h4 id ='motname'></h4>
            <div id="votecont">

            </div>
          </div>
          <div class="modal-footer">
            <button onclick="sendvote();" data-dismiss="modal" id ='submitvote' class="btn btn-primary">Submit</button>
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
          </div>
        </div>
      </div>
    </div>
  </body>
  <script type="text/javascript">
    function voting(){
      $('#voting').css('display','block');
      $('#paperwork').css('display','none');
      $('#ammendment').css('display','none');
      getmotions();

    }
    function paperwork(){
      $('#paperwork').css('display','block');
      $('#voting').css('display','none');
      $('#ammendment').css('display','none');

    }
    function ammendments(){
      $('#paperwork').css('display','none');
      $('#voting').css('display','none');
      $('#ammendment').css('display','block');
    }

    function getmotions(){
      $('#motiondata').empty();

      url='/emun/showallmotions/{{munname}}/{{commname}}'
      fetch(url, {
            headers:{
                'Accept': 'application/json',
                'X-Requested-With': 'XMLHttpRequest', //Necessary to work with request.is_ajax()
            },
      }).then(response => {
            return response.json() //Convert response to JSON
          }).then(data => {
          var motions = data['motions']
          for(let i =0; i<motions.length;i++){
            var id = motions[i]['id']
            var markup = '<tr> <td>'+'<a style="color:blue;font-weight:bold;" data-toggle="modal" data-target="#sendvotemodal"onclick = "summonvote(`'+ motions[i]['id'] +'`)">'+motions[i]['name']+'</a>'+'</td>  <td>'+motions[i]['proposer']+'</td></tr>'
            $('#motiondata').append(markup);

          }
            })
    }
    function summonvote(id){
      url = '/emun/summonvote/{{munname}}/{{commname}}/'+id.toString()+'/'+'{{country}}';
      fetch(url, {
            headers:{
                'Accept': 'application/json',
                'X-Requested-With': 'XMLHttpRequest', //Necessary to work with request.is_ajax()
            },
      }).then(response => {
            return response.json() //Convert response to JSON
          }).then(data => {
            console.log(data)
                $('#motname').html(data['motionname']);

                $('#submitvote').attr('onclick', 'submitvote("'+data['id'].toString()+'");');
              if (data['vote'] != 'NA'){
                $('#votecont').empty()
                $('#submitvote').css('display', 'none');
                $('#votecont').append('You have already voted for this Motion. Your vote was:  ' + data['vote'])
              }
              else if (data['vote'] == 'NA'){
                $('#votecont').empty();
                $('#submitvote').css('display', 'block');

                if(data['status']=='PV'){
                  markup = '<p>Important: You can vote only once, so please be completely sure of your vote as you will be unable to change it later</p> <br> <br><label for="voteopt">Vote: </label> <select id="voteopt" ><option value="Yes">YES</option><option value="No">NO</option><select>';
                  $('#votecont').append(markup);
                }
                if(data['status']=='P'){
                  markup = '<p>Important: You can vote only once, so please be completely sure of your vote as you will be unable to change it later</p><label for="voteopt">Vote: </label> <select id="voteopt" ><option value="Yes">YES</option><option value="No">NO</option><option value="Abstain">ABSTAIN</option><select>';
                  $('#votecont').append(markup);
                }
              }

            })
    }
    function submitvote(id){
      url = '/emun/sendvote/{{munname}}/{{commname}}/'+id.toString()+'/'+'{{country}}'+'/'+document.getElementById('voteopt').value.toString();

      fetch(url, {
            headers:{
                'Accept': 'application/json',
                'X-Requested-With': 'XMLHttpRequest', //Necessary to work with request.is_ajax()
            },
      }).then(response => {
            return response.json() //Convert response to JSON
          }).then(data => {
            console.log(data);

            })
    }
    function updateinfo(){
      document.cookie ='pwork=' + document.getElementById('cookiedpaperwork').value.toString() + ';';
      document.cookie ='pworktitle='+document.getElementById('resoname').value.toString()+';';
      let x = document.cookie;
      console.log(x)
    }


  </script>
  <style>
  #voting{
      display: none;
      margin : auto;
      border: solid #2F76D4 thick;
      padding: 40px;
  }
  #paperwork{
      display: none;
      margin : auto;
      border: solid #2F76D4 thick;
      padding: 40px;
  }
  #ammendment{
      display: none;
      margin : auto;
      border: solid #2F76D4 thick;
      padding: 40px;
  }
  </style>

</html>
